# Проект Intern

Проект **Intern** состоит из трех микросервисов, предназначенных для управления пользователями, задачами и уведомлениями в рамках предприятия.

## Микросервисы

### 1. **User**

Микросервис **User** отвечает за создание и управление цифровыми профилями пользователей и отделов в организации.

#### Функционал:

- **Создание и редактирование пользователей**: Возможность добавлять новых пользователей и изменять их данные.
- **Создание и редактирование отделов**: Управление отделами, включая вложенные структуры (отделы могут содержать другие отделы).
- **Рассылка уведомлений**:
    - **Всем пользователям** о создании или изменении пользователей.
    - **Всем пользователям** о создании или изменении отделов.
    - **Пользователям одного отдела** о добавлении нового пользователя в их отдел.
- **Вывод информации**:
    - Об одном пользователе.
    - Об одном отделе.
    - Дерево отделов (родительские отделы содержат дочерние).
    - Все пользователи одного отдела.

### 2. **Task**

Микросервис **Task** предназначен для автоматизации назначения и выполнения задач.

#### Функционал:

- **Рассылка универсальных задач** пользователям.
- **Уведомление пользователей** о поступлении задач.
- **Завершение задачи** со статусом "успешно" или "не успешно".
- **Уведомление**:
    - Автора и ответственных пользователей об изменении статуса задачи.
    - Автора и ответственных пользователей о комментарии к задаче.
- **Оставление комментариев** к задачам.
- **Вывод списка актуальных задач**:
    - Созданных автором.
    - Назначенных пользователю.

### 3. **Notification**

Микросервис **Notification** обрабатывает уведомления на основе сообщений, полученных из Kafka. Уведомления отправляются при различных событиях, таких как создание/изменение пользователей, создание/изменение отделов, добавление пользователей в отделы, новые задачи, завершение задач, изменение статуса задач и комментарии к задачам.

#### Функционал:

- Обработка сообщений из Kafka и отправка уведомлений пользователям на основе этих сообщений.

Вот отредактированный сценарий работы:

---

### Сценарии работы:

#### 1. Создание отдела для сотрудников
Создаем новый отдел, в котором будут работать сотрудники.

**Запрос:**
```http
[POST] http://localhost:8083/api/v1/department
```

**Тело запроса:**
```json
{
	"title": "Отдел Intern",
	"headId": null,
	"parentDepartmentId": null
}
```

#### 2. Создание сотрудников для отдела
Добавляем сотрудников в созданный отдел.

**Запрос для создания сотрудника:**
```http
[POST] http://localhost:8083/api/v1/user
```

**Тело запроса для первого сотрудника:**
```json
{
	"firstName": "Assem",
	"lastName": "Malikova",
	"contacts": {
		"email": "anna12@gmail.com",
		"cellPhone": "+77037718311"
	},
	"position": "MANAGER",
	"departmentId": 1,
	"role": "ADMIN"
}
```

**Тело запроса для второго сотрудника:**
```json
{
	"firstName": "Assem",
	"lastName": "Malikova",
	"contacts": {
		"email": "anna12@gmail.com",
		"cellPhone": "+77037718311"
	},
	"position": "DEPUTY_MANAGER",
	"departmentId": 1,
	"role": "ADMIN"
}
```

#### 3. Создание задачи и назначение исполнителей
Руководитель создает задачу и назначает ответственного сотрудника.

**Запрос:**
```http
[POST] http://localhost:8082/tasks
```

**Тело запроса:**
```json
{
	"creationDate": "2024-08-05T09:50:50.7572",
	"targetDate": "2024-08-10T18:00:00",
	"type": "ASSIGNMENT",
	"isParallel": true,
	"title": "Приоритетная задача",
	"body": "Завершить проект до срока.",
	"authorID": 1,
	"responsibles": [3]
}
```

**Процесс создания задачи включает следующие шаги:**

- Руководитель создает задачу.
- Задача назначается определенным сотрудникам.
- С помощью Spring Cloud Feign отправляется запрос другому микросервису для проверки действительности сотрудников. Если сотрудник не найден в системе, пользователю отправляется уведомление с просьбой проверить данные.
- Если данные корректны, назначенным сотрудникам отправляется уведомление через асинхронное взаимодействие. Для этого используется Apache Kafka: сообщение с ID сотрудников и текстом уведомления отправляется нужному консумеру.

**Типы задач:**

- **ASSIGNMENT**: задача может быть назначена только одному сотруднику и считается выполненной после принятия решения руководителем.
- **COMMENT**: задача закрывается, когда все назначенные сотрудники или один из них (в зависимости от `isParallel`) прокомментируют задачу.
- **NOTIFICATION**: задача закрывается сразу после создания.

---

Каждый микросервис включает в себя все возможные сценарии работы, предусмотренные для его функционала.

## Использованные технологии

- **Java 21**
- **Spring Boot 3.3.2**
- **Spring Web**
- **Spring Cloud Feign**
- **Spring Cloud Netflix: Eureka**
- **Apache Kafka**
- **PostgreSQL**
- **Упаковка и запуск в виде контейнера Docker**